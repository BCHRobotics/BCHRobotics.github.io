<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://bchrobotics.github.io/documentation/g_color-banding/">
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Color Banding - 2386 Programming</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Object Detection With Color Banding", url: "#_top", children: [
              {title: "Setup", url: "#setup" },
              {title: "Flaws", url: "#flaws" },
          ]},
        ];

    </script>
    <script src="../js/base.js"></script>
      <script src="../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../g_neural-nets/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../g_neural-nets/" class="btn btn-xs btn-link">
        Neural Networks
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../g_object-detection/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../g_object-detection/" class="btn btn-xs btn-link">
        Overview
      </a>
    </div>
    
  </div>

    

    <h1 id="object-detection-with-color-banding">Object Detection With Color Banding</h1>
<p><code>complete</code></p>
<p>This is the simpler of the two common approaches to object detection.</p>
<p>The idea is to take a source image and pick out regions that have a similar color - the color of the game piece we want to look for.</p>
<p><img alt="alt text" src="../img/od_1.png" /></p>
<p><em>This is what the camera sees. The green cross marks the center of the image.</em>
<img alt="alt text" src="../img/od_2.png" /></p>
<p><em>By looking for yellow circles in the image, we can detect the ball (the red square is its bounding box).</em></p>
<h2 id="setup">Setup</h2>
<p>Photonvision has an entire framework for color banding built into it, so it's incredibly easy to set up. First, make sure that the camera pipeline is set to <code>Colored Shape</code>. Then, all the settings you'll need to edit appear below the camera feeds in the <code>Threshold</code> and <code>Contours</code> panels. </p>
<p>Here's what that looks like:</p>
<p><img alt="alt text" src="../img/photon-dashboard.png" /></p>
<p><em>The relevant parts of the photonvision dashboard.</em></p>
<p>Panel number one, the <code>Threshold</code> panel, allows you to change what colors you're trying to look for. </p>
<p><img alt="alt text" src="../img/threshold-panel.png" /></p>
<p><em>The Threshold panel</em></p>
<p>Here's what each of the options do, more specifically:</p>
<ul>
<li><code>Hue</code> is, well, the hue of the color that you're looking for.</li>
<li><code>Saturation</code> is the saturation of said color.</li>
<li><code>Value</code> is, interestingly enough, the value of that color.</li>
<li><code>Invert Hue</code> is self explanatory.</li>
</ul>
<p>The last three buttons are important - they automatically set the colors to a spot on the image. Just press <code>SET TO AVERAGE</code> and click on the color you want in the camera feed. If you want to be more specific, press <code>SHRINK RANGE</code> and click on the color you want. Pressing <code>EXPAND RANGE</code> and clicking on another area of the image will change the color range to include the color you clicked on. This way you can very quickly tune what colors you're looking for, instead of trying to guess-and-check the HSV (Hue, Saturation, Value) values.</p>
<h3 id="note">NOTE:</h3>
<p>If you are using color banding, you will almost certainly need to re-calibrate the colors EVERY DAY at competition! Beware of this.</p>
<p>Panel number two, the <code>Contours</code> panel, allows you to change what to do with the white regions in the processed image. You can tell Photonvision to look for square regions, circular regions, and so on - I won't pretend to know what exactly Photonvision is doing behind the scenes to look for these different regions, we can just accept that it works well enough.</p>
<p><img alt="alt text" src="../img/contours-panel.png" /></p>
<p><em>The Contours panel</em></p>
<p>Here's what each of the options do:</p>
<ul>
<li>
<p><code>Target Orientation</code> does... uh idk</p>
</li>
<li>
<p><code>Target Sort</code> Tells Photonvision how to decide what's object 0, object 1, and so on.</p>
</li>
<li>
<p><code>Area</code> Is the range of percent areas that will be considered valid targets.</p>
</li>
<li>
<p><code>Fullness</code> does... idk</p>
</li>
<li>
<p><code>Perimeter</code> Is the range of perimeters (measured in pixels) that are considered valid.</p>
</li>
<li>
<p><code>Speckle Rejection</code> idk</p>
</li>
<li>
<p><code>Target Shape</code> Is the closest geometric shape to how the game piece you're looking for will APPEAR in the image (balls are circles, cubes would be squares, etc.)</p>
</li>
</ul>
<p>The rest of the settings depend on your <code>Target Shape</code>, and are fairly self-explanatory.</p>
<h2 id="flaws">Flaws</h2>
<p>Since we are only looking for color and no other characteristics like shape, this approach struggles to differentiate between items of the same color - yellow balls vs. yellow cones, for example.</p>
<p><img alt="alt text" src="../img/od_3.png" /></p>
<p><em>This time, the camera can see two yellow objects: a ball and a cone.</em>
<img alt="alt text" src="../img/od_4.png" /></p>
<p><em>As you can see, the result is a lot messier. Keep in mind that we're only trying to detect the ball.</em></p>
<p>Worse is when you accidentally detect field elements or other things in the background that have a similar color to the one you want - or just happen to look that way because of the lighting. It gets much worse when the game piece you're looking for is either red or blue (the balls from 2022 is one example) because many field elements are either red or blue. In short, if you're looking for a red or blue game piece you can abandon all hope of using color banding to find it.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../g_neural-nets/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../g_neural-nets/" class="btn btn-xs btn-link">
        Neural Networks
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../g_object-detection/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../g_object-detection/" class="btn btn-xs btn-link">
        Overview
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
</footer>

</body>
</html>